Line number: 
[166, 229]
Comment: 
This block of code manages the state transition and the direction of scanning in pattern analysis. Initially, a set of default state next stage (ns) outputs mirror their current stage counterpart values. A 'reset_scan' flag causes all these states to be reset. If a sample is validated and the previous sample was also valid, the block enters a state machine based on the previous sample. For each state ('FUZZ', 'ZERO', 'ONEEIGHTY'), various conditions based on the direction of scanning and the current sample result cause updates to the next state variables and potentially a flip in scanning direction. Each state condition also includes specific operations applied to certain next state variables with 'stg3' indicating their tracked stage.