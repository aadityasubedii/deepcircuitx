Line number: 
[556, 576]
Comment: 
This block of code calculates and stores an average value between two calculated values depending on the condition. This operation is performed based on certain inputs such as wr_level_done_r2 and the clock delay calibration completion status. At every rising edge of the clock signal, the block first ensures that if there's a reset signal, the final_val vector at index wr_i is reset. Then, if wr_level_done_r2 is true and the subsequent wr_level_done_r3 false, if oclkdelay_calib_done signal is negative, the final_val vector is set to the sum of smallest and add_smallest. Otherwise, it calculates the average of smallest[wr_i] and largest[wr_i] and stores it into the final_val[wr_i], depending on the comparison between the sum of smallest[wr_i] with add_smallest[wr_i] and largest[wr_i] with add_largest[wr_i]. Each assignment operation to final_val[wr_i] is delayed by #TCQ, presumably for synchronization reasons.